// Generated by CoffeeScript 1.6.3
(function() {
  var debug, domTpl, domTpl1, log, tinywings, tpl, tpl1, travel,
    __hasProp = {}.hasOwnProperty;

  debug = true;

  log = function() {
    if (debug) {
      return console.log.apply(console, arguments);
    }
  };

  travel = function(node, callback) {
    var _results;
    node = node.firstChild;
    _results = [];
    while (node) {
      callback(node);
      log("travel " + node);
      travel(node, callback);
      _results.push(node = node.nextSibling);
    }
    return _results;
  };

  tinywings = function(tpl) {
    var frag, tw;
    tw = {};
    frag = document.createElement('div');
    frag.innerHTML = tpl;
    tw.frag = frag;
    travel(frag, function(node) {
      var attr, bind, innerTpl, type, _ref, _ref1;
      console.log(node);
      if ((_ref = node.dataset) != null ? _ref.bind : void 0) {
        bind = node.dataset.bind;
        _ref1 = bind.split(':'), type = _ref1[0], attr = _ref1[1];
        switch (type) {
          case 'text':
            tw[attr] = function(val) {
              node.innerHTML = val;
              return log("text-bind to " + node + " with " + val);
            };
            break;
          case 'foreach':
            innerTpl = node.innerHTML;
            tw[attr] = function(val) {
              var innerDomTpl, item, key, value, _i, _len;
              node.innerHTML = '';
              log("foreach-bind to " + node + " with " + val);
              for (_i = 0, _len = val.length; _i < _len; _i++) {
                item = val[_i];
                innerDomTpl = tinywings(innerTpl);
                node.appendChild(innerDomTpl.frag.firstChild);
                for (key in innerDomTpl) {
                  if (!__hasProp.call(innerDomTpl, key)) continue;
                  value = innerDomTpl[key];
                  if (key !== 'frag') {
                    if (item[key]) {
                      innerDomTpl[key](item[key]);
                    }
                  }
                }
              }
            };
        }
      }
    });
    return tw;
  };

  tpl = '<div data-bind="text:text">\n</div>';

  tpl1 = '<div data-bind="foreach:people"><p data-bind="text:text"></p></div>';

  domTpl = tinywings(tpl);

  domTpl1 = tinywings(tpl1);

  window.onload = function() {
    document.body.appendChild(domTpl.frag.firstChild);
    document.body.appendChild(domTpl1.frag.firstChild);
    domTpl.text('something like this');
    setTimeout(function() {
      return domTpl.text('changed after 5s');
    }, 5000);
    domTpl1.people([
      {
        text: 'xxx'
      }, {
        text: 'x'
      }
    ]);
    return setTimeout(function() {
      return domTpl1.people([
        {
          text: 'xxx'
        }, {
          text: 'xxxx'
        }, {
          text: 'x'
        }
      ]);
    }, 5000);
  };

}).call(this);
